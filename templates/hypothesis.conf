upstream web { server unix:/tmp/gunicorn-h.sock fail_timeout=0; }
upstream websocket { server unix:/tmp/gunicorn-h-websocket.sock fail_timeout=0; }

server {
    listen 80;
    server_name hdev.openstax.org;
    root /var/www/h;

    location /ws {
        proxy_pass http://websocket;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_buffering off;
        proxy_set_header Upgrade $http_upgrade;
"/etc/nginx/sites-available/hypothesis.conf" [readonly] 37L, 1080C                                                                                                                        2,1           Top
        proxy_buffering off;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection upgrade;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-Server $http_host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location / {
        proxy_pass http://web;
        proxy_http_version 1.1;
        proxy_connect_timeout 10s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
                                                                                                                                                                                          13,9          52%
        proxy_connect_timeout 10s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-Server $http_host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Request-Start "t=${msec}";

    }
}
